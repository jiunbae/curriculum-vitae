name: Build and Release CV

on:
  push:
    tags:
      - 'v*'  # v1.0.0, v2.0.0 ë“± íƒœê·¸ í‘¸ì‹œ ì‹œ ì‹¤í–‰
    branches:
      - main  # main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œì—ë„ ë¹Œë“œ (ë¦´ë¦¬ìŠ¤ëŠ” íƒœê·¸ì—ë§Œ)
  pull_request:
    branches:
      - main  # PR ì‹œì—ë„ ë¹Œë“œ ê²€ì¦

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install TeX Live
      run: |
        sudo apt-get update
        # í•œêµ­ì–´ ë¬¸ì„œë¥¼ ë¹Œë“œí•˜ë ¤ë©´ kotex.styê°€ í•„ìš”í•œë°, ê¸°ë³¸ ì„¸íŠ¸ì— í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤.
        # texlive-lang-korean íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€ë¡œ ì„¤ì¹˜í•´ kotex ê´€ë ¨ ìŠ¤íƒ€ì¼ íŒŒì¼ì„ ì œê³µí•œë‹¤.
        sudo apt-get install -y texlive-xetex texlive-fonts-extra texlive-latex-extra texlive-lang-korean latexmk fonts-noto-cjk biber

    - name: Build CV PDFs
      run: make all

    - name: List generated files
      run: ls -lh build/

    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: cv-pdfs
        path: |
          build/cv_en.pdf
          build/cv_ko.pdf
        retention-days: 90

    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          build/cv_en.pdf
          build/cv_ko.pdf
        body: |
          # Curriculum Vitae - ${{ github.ref_name }}

          **English Version:** `cv_en.pdf`
          **Korean Version (í•œêµ­ì–´):** `cv_ko.pdf`

          ---

          ğŸ¤– ìë™ ìƒì„±ëœ ë¦´ë¦¬ìŠ¤ì…ë‹ˆë‹¤.

          ì´ ë¦´ë¦¬ìŠ¤ëŠ” Git íƒœê·¸ `${{ github.ref_name }}`ì—ì„œ ìë™ìœ¼ë¡œ ë¹Œë“œë˜ì—ˆìŠµë‹ˆë‹¤.
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
